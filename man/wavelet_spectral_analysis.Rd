% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wavelet_spectral_analysis.R
\name{wavelet_spectral_analysis}
\alias{wavelet_spectral_analysis}
\title{Continuous Wavelet Spectral Analysis with COI-Aware Significance}
\usage{
wavelet_spectral_analysis(
  variable,
  signif.level = 0.9,
  noise.type = "red",
  period.lower.limit = 2,
  detrend = FALSE,
  mode = c("fast", "complete"),
  return_diagnostics = TRUE,
  return_recon_error = FALSE,
  lag1_ci = FALSE,
  lag1_ci_level = 0.95,
  lag1_boot_n = 500,
  seed = NULL,
  warn_neff = FALSE,
  neff_warn_min = 5,
  neff_warn_frac = 0.6
)
}
\arguments{
\item{variable}{Numeric vector. Input time series (regularly spaced, no missing
values). Minimum length is 16 observations.}

\item{signif.level}{Numeric scalar in (0, 1). Significance level for wavelet
power and global wavelet spectrum tests. Default is 0.90.}

\item{noise.type}{Character. Background noise model for significance testing.
One of \code{"white"} or \code{"red"} (default). For red noise, an AR(1) model
is estimated using Yule-Walker.}

\item{period.lower.limit}{Numeric scalar. Minimum Fourier period (in time units)
to consider when identifying significant scales. Default is 2.}

\item{detrend}{Logical. If \code{TRUE}, removes a linear trend **slope only**
(preserves the series mean level) before wavelet analysis. Default is \code{FALSE}.}

\item{mode}{Character. Computation mode: \code{"fast"} (default) for speed-optimized
filtering with essential outputs only, or \code{"complete"} for comprehensive analysis
including reconstruction and diagnostics. Fast mode returns 9 outputs (~50 KB),
complete mode returns 18+ outputs (~5 MB). Fast mode is ~3x faster by skipping
signal reconstruction and detailed diagnostics.}

\item{return_diagnostics}{Logical. DEPRECATED. Use \code{mode = "complete"} instead.
If \code{TRUE}, forces complete mode and returns internal diagnostic quantities.}

\item{return_recon_error}{Logical. If \code{TRUE}, returns scalar reconstruction
error metrics verifying closure of reconstructed components.}

\item{lag1_ci}{Logical. If \code{TRUE}, computes a bootstrap confidence interval
for the AR(1) coefficient (diagnostic only; does not affect inference).}

\item{lag1_ci_level}{Numeric scalar in (0, 1). Confidence level for the AR(1)
bootstrap interval. Default is 0.95.}

\item{lag1_boot_n}{Integer. Number of bootstrap replicates used to estimate the
AR(1) confidence interval. Default is 500.}

\item{seed}{Optional numeric scalar. Random seed for reproducible bootstrap
diagnostics. Default is \code{NULL}.}

\item{warn_neff}{Logical. If \code{TRUE} (default), emits a warning when the
effective sample size is small for most scales.}

\item{neff_warn_min}{Numeric scalar. Threshold below which neff is considered
small. Default is 5.}

\item{neff_warn_frac}{Numeric scalar in (0, 1). Fraction of scales with
\code{neff < neff_warn_min} required to trigger a warning. Default is 0.60.}
}
\value{
A list with outputs depending on mode:

\strong{Fast mode (9 outputs):}
\describe{
  \item{gws}{Numeric vector. COI-masked global wavelet spectrum.}
  \item{gws_unmasked}{Numeric vector. Unmasked global wavelet spectrum (plotting only).}
  \item{gws_period}{Numeric vector. Fourier periods corresponding to wavelet scales.}
  \item{gws_signif}{Numeric vector. COI- and neff-corrected significance threshold (inference).}
  \item{gws_signif_unmasked}{Numeric vector. Unmasked significance threshold (plotting only).}
  \item{has_significance}{Logical. Indicates whether any significant scales were found.}
  \item{signif_periods}{Integer vector. Indices of significant wavelet scales.}
  \item{coi}{Numeric vector. Cone of influence in time units.}
  \item{power}{Numeric matrix. Wavelet power spectrum (for basic plotting).}
}

\strong{Complete mode (additional 10+ outputs):}
\describe{
  \item{power_coi}{Numeric matrix. COI-masked wavelet power.}
  \item{sigm}{Numeric matrix. Pointwise significance ratio (unmasked).}
  \item{sigm_coi}{Numeric matrix. COI-masked pointwise significance ratio.}
  \item{power_signif_coi}{Logical matrix. COI-masked pointwise significance mask.}
  \item{wave}{Complex matrix. Wavelet coefficients (scales x time).}
  \item{comps}{Numeric matrix. Reconstructed components at significant scales plus residual.}
  \item{comps_names}{Character vector. Column names of comps.}
  \item{gws_n_coi}{Numeric vector. Number of time points inside the COI per scale.}
  \item{gws_neff}{Numeric vector. Effective sample size per scale (masked).}
  \item{gws_neff_unmasked}{Numeric vector. Effective sample size per scale (unmasked).}
  \item{diagnostics}{List. Returned only if \code{return_diagnostics = TRUE}.}
  \item{reconstruction_error}{List. Returned only if \code{return_recon_error = TRUE}.}
}
}
\description{
Performs continuous wavelet transform (CWT) analysis using the Morlet mother
wavelet following Torrence & Compo (1998), with extensions for:
\itemize{
  \item cone-of-influence (COI) aware global spectrum estimation,
  \item effective sample size (neff)-based significance testing,
  \item defensible AR(1) red-noise background estimation,
  \item stable and complete signal reconstruction from significant scales.
}

The function is designed for **detection and diagnostic analysis of dominant
time scales**, not for producing orthogonal components. Reconstructed components
are scale-localized but not independent.
}
\details{
The implementation follows Torrence & Compo (1998) for the Morlet wavelet,
with the following methodological refinements:
\itemize{
  \item two-sided (TC98-consistent) wavelet normalization,
  \item COI-masked global wavelet spectrum,
  \item effective degrees of freedom based on wavelet decorrelation time,
  \item separation of inference curves from plotting curves.
}

Reconstructed components correspond to **individual wavelet scales** and are
additive but not orthogonal. They should not be interpreted as independent
stochastic modes.
}
\references{
Torrence, C., & Compo, G. P. (1998). A practical guide to wavelet analysis.
\emph{Bulletin of the American Meteorological Society}, 79(1), 61-78.
}
\seealso{
\code{\link{morlet_wavelet}}, \code{\link{extract_wavelet_components}}
}
