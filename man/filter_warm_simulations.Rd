% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/filter_warm_simulations.R
\name{filter_warm_simulations}
\alias{filter_warm_simulations}
\title{Filter and Sample WARM Simulations by Statistical and Spectral Criteria}
\usage{
filter_warm_simulations(
  series.obs = NULL,
  series.sim = NULL,
  power.obs = NULL,
  power.sim = NULL,
  power.period = NULL,
  power.signif = NULL,
  sample.num = 5,
  seed = NULL,
  save.plots = TRUE,
  save.series = TRUE,
  output.path = NULL,
  padding = TRUE,
  bounds = list(mean = 0.1, sd = 0.1, min = 0.2, max = 0.2, sig.thr = 0.8, nsig.thr =
    1.5),
  plot.prefix = "warm",
  series.units = "mm/year",
  series.conversion = 365
)
}
\arguments{
\item{series.obs}{Numeric vector. Observed annual time series (length = years).}

\item{series.sim}{Numeric matrix. Simulated time series from WARM
(nrow = years, ncol = realizations).}

\item{power.obs}{Numeric vector. Observed global wavelet power spectrum.}

\item{power.sim}{Numeric matrix. Simulated global wavelet spectra
(nrow = periods, ncol = realizations).}

\item{power.period}{Numeric vector. Periods (years) corresponding to power spectra.}

\item{power.signif}{Numeric vector. Significance thresholds for power spectra
at each period.}

\item{sample.num}{Integer. Number of realizations to sample from filtered set
for final output (default: 5).}

\item{seed}{Integer or NULL. Random seed for reproducible sampling (default: NULL).}

\item{save.plots}{Logical. Whether to save diagnostic plots to disk (default: TRUE).}

\item{save.series}{Logical. Whether to write selected series to CSV files
(default: TRUE).}

\item{output.path}{Character. Directory path for saving plots and CSV files.
Created if it doesn't exist.}

\item{padding}{Logical. Whether to include adjacent periods (plus or minus 1) around
significant periods in spectral filtering (default: TRUE).}

\item{bounds}{Named list. Tolerance bounds for filtering criteria:
\describe{
  \item{mean}{Relative tolerance for mean (default: 0.1 = 10 percent)}
  \item{sd}{Relative tolerance for standard deviation (default: 0.2 = 20 percent)}
  \item{min}{Relative tolerance for minimum value (default: 0.2 = 20 percent)}
  \item{max}{Relative tolerance for maximum value (default: 0.2 = 20 percent)}
  \item{sig.thr}{Lower bound for significant period power as fraction of
    observed power (default: 0.5 = 50 percent)}
  \item{nsig.thr}{Upper bound for non-significant period power as multiple
    of significance threshold (default: 1.5 = 150 percent)}
}}

\item{plot.prefix}{Character. Prefix for plot filenames (default: "warm").}

\item{series.units}{Character. Units label for y-axis in time series plots
(default: "mm/year").}

\item{series.conversion}{Numeric. Conversion factor for plotting. Use 365 to
convert daily values to annual (default: 365). Set to 1 if data is already
in annual units.}
}
\value{
A list with four elements:
  \describe{
    \item{subsetted}{Numeric matrix containing all realizations that passed
      all filtering criteria (ncol = number that passed)}
    \item{sampled}{Numeric matrix of randomly sampled realizations from the
      filtered set (ncol = sample.num or fewer if insufficient realizations passed)}
    \item{n_filtered}{Integer. Number of realizations that passed all filters}
    \item{filter_summary}{Data frame summarizing the number and percentage of
      realizations passing each individual filter}
  }
}
\description{
Filters synthetic time series generated by WARM (Wavelet Autoregressive Modeling)
based on statistical moments (mean, standard deviation, min, max) and spectral
properties (global wavelet power spectrum). Selects realizations that match
observed data within specified tolerance bounds, then samples a subset for
final output.
}
\details{
The function implements a multi-stage filtering process:

1. Statistical Filtering: Realizations are checked against tolerance bounds
   for mean, standard deviation, minimum, and maximum values relative to observed data.

2. Spectral Filtering: For periods identified as significant in observed data,
   realizations must have:
   (a) At least one significant period exceeding the significance threshold
   (b) All significant periods within specified bounds of observed power
   (c) Non-significant periods remaining below threshold

3. Fallback: If no realizations pass all filters, the power spectrum
   constraint is relaxed and only statistical criteria are applied.

4. Sampling: From the filtered set, a random sample of size sample.num
   is drawn for final output.

If save.plots = TRUE, four diagnostic plots are generated:
- Spectral match for all filtered realizations
- Spectral match for sampled realizations
- Violin plots of statistical criteria with sampled realizations highlighted
- Time series plot comparing observed data to sampled realizations
}
\examples{
\dontrun{
# After generating WARM simulations
filtered <- filter_warm_simulations(
  series.obs = observed_annual,
  series.sim = warm_output,
  power.obs = wavelet_results$GWS,
  power.sim = simulated_power_spectra,
  power.period = wavelet_results$period,
  power.signif = wavelet_results$GWS_signif,
  sample.num = 10,
  seed = 123,
  output.path = "results/warm_filtering",
  bounds = list(
    mean = 0.1,    # +/- 10\% for mean
    sd = 0.15,     # +/- 15\% for standard deviation
    min = 0.2,     # +/- 20\% for minimum
    max = 0.2,     # +/- 20\% for maximum
    sig.thr = 0.5, # Significant periods >= 50\% of observed
    nsig.thr = 1.5 # Non-significant periods <= 150\% of threshold
  )
)

# Access results
cat("Realizations passing filters:", filtered$n_filtered, "\n")
print(filtered$filter_summary)

# Use sampled realizations for further analysis
selected_traces <- filtered$sampled
}

}
\references{
Steinschneider, S. and Lall, U. (2015). A hierarchical Bayesian regional model
for nonstationary precipitation extremes in Northern California conditioned on
tropical moisture exports. \emph{Water Resources Research}, 51(3), 1472-1492.
}
\seealso{
\code{\link{wavelet_arima}} for generating WARM simulations,
\code{\link{wavelet_spectral_analysis}} for computing power spectra
}
