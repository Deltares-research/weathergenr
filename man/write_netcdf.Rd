% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/write_netcdf.R
\name{write_netcdf}
\alias{write_netcdf}
\title{Write Gridded Data to a NetCDF File (Template-Based)}
\usage{
write_netcdf(
  data = NULL,
  coord.grid = NULL,
  output.path = NULL,
  origin.date = NULL,
  calendar.type = "noleap",
  nc.template.file = NULL,
  nc.compression = 4,
  nc.spatial.ref = "spatial_ref",
  nc.file.prefix = "clim_change_rlz",
  nc.file.suffix = "",
  signif.digits = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{List of length \code{nrow(coord.grid)}. Each element is a named list of
numeric vectors (time series) for each variable to be written. All list elements must
have identical variable names and identical time series lengths.}

\item{coord.grid}{Data frame mapping grid cells to template indices. Must contain
integer columns \code{xind} and \code{yind} (1-based indices) and have
\code{nrow(coord.grid) == length(data)}. Indices must be within the template x/y bounds.}

\item{output.path}{Character string. Directory where the NetCDF file will be written.
Created if it does not exist.}

\item{origin.date}{Date or character coercible to \code{Date}. Used to define the time units
(days since origin date at 00:00:00).}

\item{calendar.type}{Character string. NetCDF calendar attribute for the time dimension
(e.g., \code{"noleap"}). Passed to \code{ncdf4::ncdim_def()}.}

\item{nc.template.file}{Character string. Path to an existing template NetCDF file used to
infer dimensions, coordinate values, spatial reference, and global attributes.}

\item{nc.compression}{Integer in \code{[0, 9]}. NetCDF-4 deflate compression level applied
to output variables.}

\item{nc.spatial.ref}{Character string. Name of the spatial reference variable in the
template to copy to output (default \code{"spatial_ref"}). The variable must contain
attributes \code{x_dim} and \code{y_dim}.}

\item{nc.file.prefix}{Character string. Output file prefix (base name without extension).}

\item{nc.file.suffix}{Character string. Optional suffix appended to the file name after an
underscore. If \code{""}, no suffix is added.}

\item{signif.digits}{Optional integer. If provided, all values in \code{data} are rounded
using \code{round(x, signif.digits)} prior to writing.}

\item{verbose}{Logical scalar. If \code{TRUE}, progress messages are emitted using
\code{logger::log_info()} with a \code{[NetCDF]} tag.}
}
\value{
Invisibly returns the full path to the written NetCDF file (character scalar).
}
\description{
Writes gridded climate/weather time series to a NetCDF file using a template NetCDF
as the schema source (dimensions, spatial reference variable, and global attributes).
The function expects a list of grid-cell payloads (each containing identical variable
names and equal-length time series) and places each cell into the output raster cube
according to \code{coord.grid} indices. Output is written as NetCDF-4 with optional
compression and optional early rounding of values.
}
\details{
The template file provided via \code{nc.template.file} is opened to:
\itemize{
  \item validate that the spatial reference variable \code{nc.spatial.ref} exists;
  \item read \code{x_dim} and \code{y_dim} attributes from the spatial reference variable
        to determine the x/y dimension names in the template;
  \item copy the spatial reference variable values and its attributes into the output file;
  \item copy template global attributes into the output file (best-effort);
  \item define output x/y dimension coordinate values based on template dimension values.
}

A \code{time} dimension is defined as \code{0:(nt - 1)} with units
\code{"days since <origin.date> 00:00:00"} and the specified \code{calendar.type}.
Each variable in \code{data[[1]]} is written as a 3D array with dimension order
\code{time x y x x}. Grid cells are inserted at \code{[ , yind, xind ]} locations.

The output filename is constructed as:
\code{file.path(output.path, paste0(nc.file.prefix, optional_suffix, ".nc"))}
where \code{optional_suffix} is \code{paste0("_", nc.file.suffix)} when
\code{nc.file.suffix != ""}.
}
\section{File structure}{

\itemize{
  \item Dimensions: \code{time}, template \code{y}, template \code{x}
  \item Variables: one variable per name in \code{names(data[[1]])}, plus \code{nc.spatial.ref}
  \item Global attributes: copied from template (best-effort) plus \code{creation_date} and
        \code{created_with}
}
}

\section{Side effects}{

Creates directories (if needed), writes a NetCDF file, and may overwrite an existing output
file with the same name (a warning is issued).
}

\examples{
\dontrun{
# Minimal example (schematic)
coord.grid <- data.frame(xind = c(1, 2), yind = c(1, 1))
data <- list(
  list(prcp = rnorm(365), tavg = rnorm(365)),
  list(prcp = rnorm(365), tavg = rnorm(365))
)

out_file <- write_netcdf(
  data = data,
  coord.grid = coord.grid,
  output.path = "out",
  origin.date = "1990-01-01",
  calendar.type = "noleap",
  nc.template.file = "template.nc",
  nc.file.prefix = "clim_change_rlz",
  nc.file.suffix = "run01",
  nc.compression = 4,
  signif.digits = 3,
  verbose = TRUE
)
}

}
