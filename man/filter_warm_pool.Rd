% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/warm_filtering.R
\name{filter_warm_pool}
\alias{filter_warm_pool}
\title{Filter and sample WARM realizations using distributional, tail, and spectral criteria}
\usage{
filter_warm_pool(
  obs_series = NULL,
  sim_series = NULL,
  n_select = 5,
  seed = NULL,
  relax_order = c("wavelet", "sd", "tail_low", "tail_high", "mean"),
  filter_bounds = list(),
  wavelet_args = list(signif_level = 0.8, noise_type = "red", period_lower_limit = 2,
    detrend = TRUE),
  modwt_n_levels = NULL,
  make_plots = FALSE,
  verbose = FALSE
)
}
\arguments{
\item{obs_series}{Numeric vector. Observed annual series used as the reference.}

\item{sim_series}{Numeric matrix. Simulated annual realizations with years in rows
and realizations in columns.}

\item{n_select}{Integer scalar. Number of realizations to return in \code{selected}.}

\item{seed}{Optional integer scalar. Random seed used for window selection (if lengths differ)
and for sampling from the final candidate pool.}

\item{relax_order}{Character vector. Relaxation priority ordering for criteria.
Must contain each of \code{c("mean","sd","tail_low","tail_high","wavelet")} exactly once.}

\item{filter_bounds}{Named list. Filtering thresholds and relaxation controls. Any entry
overrides internal defaults. Uses snake_case keys.}

\item{wavelet_args}{Named list passed to \code{\link{analyze_wavelet_spectrum}} for
observed and simulated series (e.g., \code{signif_level}, \code{noise_type},
\code{period_lower_limit}, \code{detrend}).}

\item{modwt_n_levels}{Integer or NULL. Number of MODWT levels used in WARM simulation.
Used to determine the low-frequency threshold period as 2^J. If NULL, estimated from
series length.}

\item{make_plots}{Logical scalar. If \code{TRUE}, returns diagnostic plots in \code{plots}.}

\item{verbose}{Logical scalar. If \code{TRUE}, logs per-iteration pass rates and relaxation steps.}
}
\value{
A list with:
\describe{
  \item{pool}{Numeric matrix. Final candidate pool (subset of columns from \code{sim_series}).}
  \item{selected}{Numeric matrix. \code{n_select} realizations selected from the final pool.}
  \item{summary}{Data frame summarising pass counts/rates and selection mode.}
  \item{diagnostics}{List with window metadata, indices, relaxation log, spectral metrics,
    and final bounds.}
  \item{plots}{NULL or a named list of ggplot objects when \code{make_plots = TRUE}.}
}
}
\description{
Filters an ensemble of WARM-generated annual realizations against an observed
annual series using three criterion families:
\itemize{
  \item \strong{Distributional}: relative differences in mean and standard deviation.
  \item \strong{Tail behaviour}: lower/upper tail mass relative to observed quantile thresholds.
  \item \strong{Spectral matching}: direct comparison of simulated vs observed global
    wavelet spectra, focusing on reproducing low-frequency structure and dominant peaks.
}

Spectral matching criteria include:
\itemize{
  \item \strong{Spectral correlation}: correlation between log-transformed GWS of
    simulated and observed series.
  \item \strong{Low-frequency fraction}: relative difference in variance fraction
    at periods beyond a threshold tied to MODWT decomposition levels.
  \item \strong{Peak matching}: verification that dominant peaks in observed spectrum
    are reproduced in simulated spectrum within tolerance.
}

If fewer than \code{n_select} realizations pass, the function relaxes criteria
iteratively (up to \code{filter_bounds$relax_max_iter}) by loosening the currently
most restrictive active filter (lowest pass rate). If still insufficient, a
deterministic fallback returns the \code{n_select} realizations with the smallest
absolute relative mean difference.
}
