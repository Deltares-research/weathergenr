% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/warm_filtering.R
\name{filter_warm_pool}
\alias{filter_warm_pool}
\title{Filter and sample WARM realizations using distributional, tail, and spectral criteria}
\usage{
filter_warm_pool(
  obs_series = NULL,
  sim_series = NULL,
  n_select = 5,
  seed = NULL,
  relax_order = c("wavelet", "sd", "tail_low", "tail_high", "mean"),
  filter_bounds = list(),
  wavelet_args = list(signif_level = 0.8, noise_type = "red", period_lower_limit = 2,
    detrend = TRUE),
  modwt_n_levels = NULL,
  make_plots = FALSE,
  parallel = FALSE,
  n_cores = NULL,
  verbose = FALSE
)
}
\arguments{
\item{obs_series}{Numeric vector. Observed annual series used as the
reference target.}

\item{sim_series}{Numeric matrix. Simulated annual realizations with years
in rows and realizations in columns.}

\item{n_select}{Integer scalar. Number of realizations to return in the
\code{selected} element.}

\item{seed}{Integer scalar or NULL. If provided, sets the random seed used
for selecting alignment windows when \code{obs_series} and \code{sim_series}
have different lengths, and for sampling within the final candidate pool.}

\item{relax_order}{Character vector. Relaxation priority ordering for the
filter families. Must contain exactly: \code{"mean"}, \code{"sd"},
\code{"tail_low"}, \code{"tail_high"}, \code{"wavelet"}.}

\item{filter_bounds}{Named list. Overrides for filtering thresholds and
relaxation controls. Keys must be snake case and match those returned by
\code{filter_warm_bounds_defaults()}.}

\item{wavelet_args}{Named list. Parameters passed to
\code{analyze_wavelet_spectrum()} for observed and simulated series.
Expected entries include \code{signif_level}, \code{noise_type},
\code{period_lower_limit}, and \code{detrend}.}

\item{modwt_n_levels}{Integer or NULL. Number of MODWT levels used in WARM.
This value is used only for diagnostics. If NULL, a value is estimated from
the series length.}

\item{make_plots}{Logical scalar. If TRUE, compute diagnostic plots for the
selected realizations and return them in \code{plots}.}

\item{parallel}{Logical scalar. If TRUE, allows spectral metrics to be
computed in parallel inside \code{compute_spectral_metrics()}.}

\item{n_cores}{Integer scalar or NULL. Number of worker processes to use for
parallel execution. If NULL, an internal default is used.}

\item{verbose}{Logical scalar. If TRUE, logs setup information, per iteration
pass rates, and relaxation actions.}
}
\value{
Named list with the following elements:
\describe{
  \item{pool}{Numeric matrix. Candidate pool of realizations that passed the
  final set of filters. Subset of columns from \code{sim_series}.}
  \item{selected}{Numeric matrix. The \code{n_select} realizations chosen from
  the pool. Subset of columns from \code{sim_series}.}
  \item{summary}{Data frame. Pass counts and pass rates for each filter
  family, plus the selection mode used.}
  \item{diagnostics}{List. Window metadata, relaxation log, spectral
  diagnostics, spectral metrics, and the final bounds used.}
  \item{plots}{NULL or a named list of ggplot objects when
  \code{make_plots = TRUE}.}
}
}
\description{
Filters an ensemble of annual WARM realizations against an observed annual
reference series. Filtering is based on three families of criteria:
distributional moments, tail mass behavior, and spectral similarity from the
global wavelet spectrum.

The function computes pass or fail vectors for each filter family and builds
a candidate pool. If the pool is smaller than the requested sample size, the
function relaxes thresholds iteratively until enough candidates are found or
the maximum number of relaxation iterations is reached.

Relaxation is adaptive. At each iteration, the currently most restrictive
active filter is relaxed, defined as the filter with the lowest pass rate
among the active filters. This is constrained by the relaxation order given
in \code{relax_order}, which sets which filters are eligible to be relaxed
and how wavelet relaxation is parameterized.

If the pool is still smaller than \code{n_select} after relaxation, a
deterministic fallback selects the \code{n_select} realizations with the
smallest absolute relative mean difference.
}
