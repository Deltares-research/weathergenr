% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_weather_series.R
\name{generate_weather_series}
\alias{generate_weather_series}
\title{Generate Synthetic Gridded Daily Weather Series}
\usage{
generate_weather_series(
  weather.data = NULL,
  weather.grid = NULL,
  weather.date = NULL,
  variables = NULL,
  sim.year.num = NULL,
  sim.year.start = 2020,
  month.start = 1,
  realization.num = 5,
  warm.variable = "precip",
  warm.signif.level = 0.9,
  warm.sample.num = 5000,
  warm.subset.criteria = list(mean = 0.1, sd = 0.1, min = 0.1, max = 0.1, sig.thr = 0.8,
    nsig.thr = 1.5),
  knn.sample.num = 120,
  mc.wet.quantile = 0.3,
  mc.extreme.quantile = 0.8,
  dry.spell.change = rep(1, 12),
  wet.spell.change = rep(1, 12),
  output.path = tempdir(),
  seed = NULL,
  compute.parallel = FALSE,
  num.cores = NULL
)
}
\arguments{
\item{weather.data}{Named list of data frames (one per grid cell) with observed
daily weather. Each data frame must have one row per day corresponding to
\code{weather.date}, and columns for all \code{variables}.}

\item{weather.grid}{Data frame describing grid cells. Must contain columns
\code{id}, \code{xind}, \code{yind}, \code{x}, \code{y}.}

\item{weather.date}{Vector of class \code{Date} corresponding to rows of each
\code{weather.data[[i]]}. May include Feb 29; Feb 29 is removed internally
along with the corresponding rows in \code{weather.data}.}

\item{variables}{Character vector of daily variables to simulate
(e.g., \code{c("precip","temp")}).}

\item{sim.year.num}{Integer number of years to simulate. If \code{NULL},
defaults to the number of unique historical simulation-years (calendar year
or water year depending on \code{month.start}).}

\item{sim.year.start}{Integer first simulation year (calendar year if
\code{month.start == 1}, otherwise first water year).}

\item{month.start}{Integer in \code{1:12}. First month of the simulation year.}

\item{realization.num}{Integer number of realizations to generate.}

\item{warm.variable}{Character name of the annual driver variable used in WARM
(must be in \code{variables}).}

\item{warm.signif.level}{Numeric in (0,1). Wavelet significance level for
retaining low-frequency components in WARM.}

\item{warm.sample.num}{Integer number of candidate annual traces to generate
before subsetting.}

\item{warm.subset.criteria}{Named list of thresholds used to filter annual WARM
traces (must include \code{mean}, \code{sd}, \code{min}, \code{max},
\code{sig.thr}, \code{nsig.thr}).}

\item{knn.sample.num}{Integer number of historical years sampled in annual KNN.}

\item{mc.wet.quantile}{Numeric in (0,1). Wet-day threshold quantile.}

\item{mc.extreme.quantile}{Numeric in (0,1). Extreme-day threshold quantile.}

\item{dry.spell.change}{Numeric length-12 vector of monthly dry-spell adjustment factors.}

\item{wet.spell.change}{Numeric length-12 vector of monthly wet-spell adjustment factors.}

\item{output.path}{Character directory for diagnostics/CSV outputs.}

\item{seed}{Optional integer seed for reproducibility.}

\item{compute.parallel}{Logical; if \code{TRUE}, run disaggregation in parallel.}

\item{num.cores}{Optional integer number of cores for parallel execution.}
}
\value{
A list with:
\describe{
  \item{resampled}{Tibble/data.frame with one column per realization. Each
    column contains the historical \code{dateo} values selected as analogues
    for each simulated day.}
  \item{dates}{Vector of \code{Date} giving the simulated daily time axis
    (Feb 29 excluded).}
}
}
\description{
Generate stochastic gridded daily weather by coupling an annual-scale
low-frequency generator with daily-scale resampling and persistence logic.
The workflow combines:
\itemize{
  \item Wavelet Autoregressive Modeling (WARM) on an annual aggregate of
        \code{warm.variable} to simulate low-frequency variability,
  \item annual K-nearest-neighbor (KNN) matching to select historical analogue years,
  \item a three-state (dry, wet, extreme) daily Markov chain to control spell persistence,
  \item daily KNN resampling of precipitation and temperature anomalies.
}

The simulation regime is inferred from \code{month.start}:
\itemize{
  \item \code{month.start == 1}: calendar-year simulation,
  \item \code{month.start != 1}: water-year simulation starting at \code{month.start}.
}
}
\details{
\strong{Calendar handling (robust Gregorian input):}
Inputs may be on the Gregorian calendar and may include Feb 29. Internally,
the function enforces a 365-day calendar by removing Feb 29 from \code{weather.date}
and dropping the corresponding rows from every element of \code{weather.data}.
All downstream processing and outputs therefore use a 365-day calendar.

\strong{Workflow:}
\enumerate{
  \item \strong{Historical preprocessing:} enforce a 365-day calendar, compute
        calendar/water-year indices, and build a historical dates table used for
        KNN matching and Markov chain sequencing.
  \item \strong{Annual WARM simulation:} aggregate historical daily data to annual
        means (by water year if applicable), run wavelet analysis on the annual
        series, simulate candidate annual traces via \code{\link{wavelet_arima}},
        and subset traces using \code{\link{filter_warm_simulations}}.
  \item \strong{Daily disaggregation:} for each realization, call
        \code{resample_weather_dates()} to generate a simulated sequence of
        historical analogue dates (in the internal 365-day calendar).
  \item \strong{Output construction:} map resampled internal dates back to
        historical observation dates (\code{dateo}) and return simulated dates.
}
}
