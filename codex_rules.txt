You are modifying an R package named "weathergenr".

GOAL
- Improve correctness, readability, maintainability, and testability.
- Make changes minimal and surgical; do not introduce broad rewrites unless explicitly requested.

HARD CONSTRAINTS (must follow)
- Keep all files UTF-8.
- Do not introduce the purrr package or functional programming rewrites; prefer explicit for-loops.
- Do not change exported function names, arguments, or return structure unless explicitly instructed.
- Do not add new external package dependencies unless explicitly instructed.
- Prefer base R and existing Imports; if a new dependency is unavoidable, justify it and keep it minimal.
- Preserve deterministic behavior: keep seeds / randomness controlled where relevant.

PACKAGE CONVENTIONS (weathergenr)
- Internal helper functions are prefixed with a dot: .helper_name().
- User-facing functions are snake_case without leading dots.
- Argument names: snake_case, descriptive, avoid abbreviations unless established in the package.
- Use `stop(..., call. = FALSE)` for user-facing errors; use `warning()` sparingly; use logger only if file already uses it.
- Use `stats::`, `utils::`, etc. for non-imported base packages where appropriate.

STYLE
- Prefer early returns and guard clauses for input validation.
- Use explicit type/length checks; validate scalars using internal helpers (e.g., .is_int_scalar()) if present.
- Avoid deep nesting; extract small helpers where it improves readability.
- Use consistent naming: `obs_*`, `sim_*`, `cfg`, `out`, `idx`, `n_*`, `is_*`.

DOCUMENTATION
- Add/update roxygen2 for exported functions:
  - @description: one paragraph, what it does.
  - @details: key assumptions and edge cases (brief).
  - @param: precise types/dimensions/units; mention NA handling.
  - @return: exact structure, class, and key fields.
  - @examples: minimal and fast (no large data); wrap expensive in \dontrun{}.
- For internal functions: keep @keywords internal and minimal docs (only if needed).
- Ensure roxygen matches actual behavior; do not invent parameters.

TESTS
- If you change behavior, add/adjust testthat tests.
- Prefer small deterministic tests; avoid network, randomness without seeds, or large fixtures.
- Ensure tests cover: input validation, NA handling, edge cases (empty/constant series), and expected structure.

OUTPUT REQUIREMENTS
- Provide a clear diff-style set of changes.
- Summarize changes in bullet points:
  - what changed
  - why
  - risks/assumptions
- If you make a design choice (e.g., handling leap days), state it explicitly.

DO NOT
- Do not reformat entire files (no sweeping style-only changes).
- Do not change user-visible outputs unless requested.
- Do not silently drop columns/fields.
