<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter and sample WARM realizations using distributional, tail, and spectral criteria — filter_warm_pool • weathergenr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter and sample WARM realizations using distributional, tail, and spectral criteria — filter_warm_pool"><meta name="description" content="Filters an ensemble of annual WARM realizations against an observed annual
reference series. Filtering is based on three families of criteria:
distributional moments, tail mass behavior, and spectral similarity from the
global wavelet spectrum.
The function computes pass or fail vectors for each filter family and builds
a candidate pool. If the pool is smaller than the requested sample size, the
function relaxes thresholds iteratively until enough candidates are found or
the maximum number of relaxation iterations is reached.
Relaxation is adaptive. At each iteration, the currently most restrictive
active filter is relaxed, defined as the filter with the lowest pass rate
among the active filters. This is constrained by the relaxation order given
in relax_order, which sets which filters are eligible to be relaxed
and how wavelet relaxation is parameterized.
If the pool is still smaller than n_select after relaxation, a
deterministic fallback selects the n_select realizations with the
smallest absolute relative mean difference."><meta property="og:description" content="Filters an ensemble of annual WARM realizations against an observed annual
reference series. Filtering is based on three families of criteria:
distributional moments, tail mass behavior, and spectral similarity from the
global wavelet spectrum.
The function computes pass or fail vectors for each filter family and builds
a candidate pool. If the pool is smaller than the requested sample size, the
function relaxes thresholds iteratively until enough candidates are found or
the maximum number of relaxation iterations is reached.
Relaxation is adaptive. At each iteration, the currently most restrictive
active filter is relaxed, defined as the filter with the lowest pass rate
among the active filters. This is constrained by the relaxation order given
in relax_order, which sets which filters are eligible to be relaxed
and how wavelet relaxation is parameterized.
If the pool is still smaller than n_select after relaxation, a
deterministic fallback selects the n_select realizations with the
smallest absolute relative mean difference."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">weathergenr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Deltares-research/weathergenr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter and sample WARM realizations using distributional, tail, and spectral criteria</h1>
      <small class="dont-index">Source: <a href="https://github.com/Deltares-research/weathergenr/blob/HEAD/R/warm_filtering.R" class="external-link"><code>R/warm_filtering.R</code></a></small>
      <div class="d-none name"><code>filter_warm_pool.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Filters an ensemble of annual WARM realizations against an observed annual
reference series. Filtering is based on three families of criteria:
distributional moments, tail mass behavior, and spectral similarity from the
global wavelet spectrum.</p>
<p>The function computes pass or fail vectors for each filter family and builds
a candidate pool. If the pool is smaller than the requested sample size, the
function relaxes thresholds iteratively until enough candidates are found or
the maximum number of relaxation iterations is reached.</p>
<p>Relaxation is adaptive. At each iteration, the currently most restrictive
active filter is relaxed, defined as the filter with the lowest pass rate
among the active filters. This is constrained by the relaxation order given
in <code>relax_order</code>, which sets which filters are eligible to be relaxed
and how wavelet relaxation is parameterized.</p>
<p>If the pool is still smaller than <code>n_select</code> after relaxation, a
deterministic fallback selects the <code>n_select</code> realizations with the
smallest absolute relative mean difference.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_warm_pool</span><span class="op">(</span></span>
<span>  obs_series <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sim_series <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_select <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relax_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wavelet"</span>, <span class="st">"sd"</span>, <span class="st">"tail_low"</span>, <span class="st">"tail_high"</span>, <span class="st">"mean"</span><span class="op">)</span>,</span>
<span>  filter_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wavelet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>signif_level <span class="op">=</span> <span class="fl">0.8</span>, noise_type <span class="op">=</span> <span class="st">"red"</span>, period_lower_limit <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    detrend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  modwt_n_levels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  make_plots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache_gws <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obs-series">obs_series<a class="anchor" aria-label="anchor" href="#arg-obs-series"></a></dt>
<dd><p>Numeric vector. Observed annual series used as the
reference target.</p></dd>


<dt id="arg-sim-series">sim_series<a class="anchor" aria-label="anchor" href="#arg-sim-series"></a></dt>
<dd><p>Numeric matrix. Simulated annual realizations with years
in rows and realizations in columns.</p></dd>


<dt id="arg-n-select">n_select<a class="anchor" aria-label="anchor" href="#arg-n-select"></a></dt>
<dd><p>Integer scalar. Number of realizations to return in the
<code>selected</code> element.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer scalar or NULL. If provided, sets the random seed used
for selecting alignment windows when <code>obs_series</code> and <code>sim_series</code>
have different lengths, and for sampling within the final candidate pool.</p></dd>


<dt id="arg-relax-order">relax_order<a class="anchor" aria-label="anchor" href="#arg-relax-order"></a></dt>
<dd><p>Character vector. Relaxation priority ordering for the
filter families. Must contain exactly: <code>"mean"</code>, <code>"sd"</code>,
<code>"tail_low"</code>, <code>"tail_high"</code>, <code>"wavelet"</code>.</p></dd>


<dt id="arg-filter-bounds">filter_bounds<a class="anchor" aria-label="anchor" href="#arg-filter-bounds"></a></dt>
<dd><p>Named list. Overrides for filtering thresholds and
relaxation controls. Keys must be snake case and match those returned by
<code><a href="filter_warm_bounds_defaults.html">filter_warm_bounds_defaults()</a></code>.</p></dd>


<dt id="arg-wavelet-args">wavelet_args<a class="anchor" aria-label="anchor" href="#arg-wavelet-args"></a></dt>
<dd><p>Named list. Parameters passed to
<code><a href="analyze_wavelet_spectrum.html">analyze_wavelet_spectrum()</a></code> for observed and simulated series.
Expected entries include <code>signif_level</code>, <code>noise_type</code>,
<code>period_lower_limit</code>, and <code>detrend</code>.</p></dd>


<dt id="arg-modwt-n-levels">modwt_n_levels<a class="anchor" aria-label="anchor" href="#arg-modwt-n-levels"></a></dt>
<dd><p>Integer or NULL. Number of MODWT levels used in WARM.
This value is used only for diagnostics. If NULL, a value is estimated from
the series length.</p></dd>


<dt id="arg-make-plots">make_plots<a class="anchor" aria-label="anchor" href="#arg-make-plots"></a></dt>
<dd><p>Logical scalar. If TRUE, compute diagnostic plots for the
selected realizations and return them in <code>plots</code>.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical scalar. If TRUE, allows spectral metrics to be
computed in parallel inside <code><a href="compute_spectral_metrics.html">compute_spectral_metrics()</a></code>.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Integer scalar or NULL. Number of worker processes to use for
parallel execution. If NULL, an internal default is used.</p></dd>


<dt id="arg-cache-gws">cache_gws<a class="anchor" aria-label="anchor" href="#arg-cache-gws"></a></dt>
<dd><p>Logical scalar. If TRUE, cache simulated global wavelet
spectra for diagnostics; this can increase memory use.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical scalar. If TRUE, logs setup information, per iteration
pass rates, and relaxation actions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Named list with the following elements:</p><dl><dt>pool</dt>
<dd><p>Numeric matrix. Candidate pool of realizations that passed the
  final set of filters. Subset of columns from <code>sim_series</code>.</p></dd>

  <dt>selected</dt>
<dd><p>Numeric matrix. The <code>n_select</code> realizations chosen from
  the pool. Subset of columns from <code>sim_series</code>.</p></dd>

  <dt>summary</dt>
<dd><p>Data frame. Pass counts and pass rates for each filter
  family, plus the selection mode used.</p></dd>

  <dt>diagnostics</dt>
<dd><p>List. Window metadata, relaxation log, spectral
  diagnostics, spectral metrics, and the final bounds used. When
  <code>cache_gws = TRUE</code>, includes <code>gws_cache</code>.</p></dd>

  <dt>plots</dt>
<dd><p>NULL or a named list of ggplot objects when
  <code>make_plots = TRUE</code>.</p></dd>


</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">

</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

