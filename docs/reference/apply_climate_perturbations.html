<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Apply Monthly Climate Perturbations to Gridded Daily Weather Series — apply_climate_perturbations • weathergenr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply Monthly Climate Perturbations to Gridded Daily Weather Series — apply_climate_perturbations"><meta name="description" content="Applies monthly climate perturbations to daily gridded weather simulations in a
modular and physically interpretable way. The function operates independently on
precipitation intensity, precipitation occurrence, temperature, and (optionally)
potential evapotranspiration (PET).
The perturbation workflow is:
1. Construct a simulation-year index from `date` (`1..n_years`).
2. Optionally modify monthly wet-day probabilities within each (year index, month) group.
3. Apply precipitation intensity perturbations to wet days using Gamma-based quantile mapping
   via [adjust_precipitation_qm()].
4. Apply temperature perturbations using monthly additive deltas (step change or transient ramp).
5. Optionally recompute PET from perturbed temperature fields.
This function is intended for climate stress testing and scenario analysis, where
controlled changes in mean climate, variability, and extremes are required while
preserving realistic daily structure."><meta property="og:description" content="Applies monthly climate perturbations to daily gridded weather simulations in a
modular and physically interpretable way. The function operates independently on
precipitation intensity, precipitation occurrence, temperature, and (optionally)
potential evapotranspiration (PET).
The perturbation workflow is:
1. Construct a simulation-year index from `date` (`1..n_years`).
2. Optionally modify monthly wet-day probabilities within each (year index, month) group.
3. Apply precipitation intensity perturbations to wet days using Gamma-based quantile mapping
   via [adjust_precipitation_qm()].
4. Apply temperature perturbations using monthly additive deltas (step change or transient ramp).
5. Optionally recompute PET from perturbed temperature fields.
This function is intended for climate stress testing and scenario analysis, where
controlled changes in mean climate, variability, and extremes are required while
preserving realistic daily structure."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">weathergenr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Deltares-research/weathergenr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Apply Monthly Climate Perturbations to Gridded Daily Weather Series</h1>
      <small class="dont-index">Source: <a href="https://github.com/Deltares-research/weathergenr/blob/HEAD/R/climate_perturbations.R" class="external-link"><code>R/climate_perturbations.R</code></a></small>
      <div class="d-none name"><code>apply_climate_perturbations.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Applies monthly climate perturbations to daily gridded weather simulations in a
modular and physically interpretable way. The function operates independently on
precipitation intensity, precipitation occurrence, temperature, and (optionally)
potential evapotranspiration (PET).</p>
<p>The perturbation workflow is:
1. Construct a simulation-year index from `date` (`1..n_years`).
2. Optionally modify monthly wet-day probabilities within each (year index, month) group.
3. Apply precipitation intensity perturbations to wet days using Gamma-based quantile mapping
   via [adjust_precipitation_qm()].
4. Apply temperature perturbations using monthly additive deltas (step change or transient ramp).
5. Optionally recompute PET from perturbed temperature fields.</p>
<p>This function is intended for climate stress testing and scenario analysis, where
controlled changes in mean climate, variability, and extremes are required while
preserving realistic daily structure.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">apply_climate_perturbations</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_mean_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_var_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_occurrence_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_intensity_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  temp_delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  temp_transient <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  precip_transient <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  precip_occurrence_transient <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compute_pet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pet_method <span class="op">=</span> <span class="st">"hargreaves"</span>,</span>
<span>  qm_fit_method <span class="op">=</span> <span class="st">"mme"</span>,</span>
<span>  scale_var_with_mean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  exaggerate_extremes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extreme_prob_threshold <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  extreme_k <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  enforce_target_mean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  precip_cap_mm_day <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_floor_mm_day <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  precip_cap_quantile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  diagnostic <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>List of data.frames, one per grid cell. Each data.frame must contain `precip`,
`temp`, `temp_min`, and `temp_max`. If `compute_pet = TRUE`, a column `pet` is added or
overwritten.</p></dd>


<dt id="arg-grid">grid<a class="anchor" aria-label="anchor" href="#arg-grid"></a></dt>
<dd><p>Data frame of grid metadata with `nrow(grid) == length(data)`. Must include a
latitude column: `lat` (preferred) or `y` (legacy).</p></dd>


<dt id="arg-date">date<a class="anchor" aria-label="anchor" href="#arg-date"></a></dt>
<dd><p>Date vector with length equal to the number of rows in each grid-cell data.frame.
Used to derive month and simulation-year indices.</p></dd>


<dt id="arg-precip-mean-factor">precip_mean_factor<a class="anchor" aria-label="anchor" href="#arg-precip-mean-factor"></a></dt>
<dd><p>Numeric vector of length 12 or numeric matrix `(n_years x 12)`. Monthly
multiplicative factors applied to wet-day precipitation mean during intensity perturbation.</p></dd>


<dt id="arg-precip-var-factor">precip_var_factor<a class="anchor" aria-label="anchor" href="#arg-precip-var-factor"></a></dt>
<dd><p>Numeric vector of length 12 or numeric matrix `(n_years x 12)`. Monthly
multiplicative factors applied to wet-day precipitation variance.</p></dd>


<dt id="arg-precip-occurrence-factor">precip_occurrence_factor<a class="anchor" aria-label="anchor" href="#arg-precip-occurrence-factor"></a></dt>
<dd><p>Optional numeric vector of length 12 or numeric matrix `(n_years x 12)`.
Multiplicative factors applied to monthly wet-day probability.</p></dd>


<dt id="arg-precip-intensity-threshold">precip_intensity_threshold<a class="anchor" aria-label="anchor" href="#arg-precip-intensity-threshold"></a></dt>
<dd><p>Numeric scalar `&gt;= 0`. Defines wet days as `precip &gt; precip_intensity_threshold`.
Also passed to [adjust_precipitation_qm()] as `intensity_threshold`. Default is 0.</p></dd>


<dt id="arg-temp-delta">temp_delta<a class="anchor" aria-label="anchor" href="#arg-temp-delta"></a></dt>
<dd><p>Numeric vector of length 12. Monthly additive temperature deltas (degC) applied to
`temp`, `temp_min`, and `temp_max`.</p></dd>


<dt id="arg-temp-transient">temp_transient<a class="anchor" aria-label="anchor" href="#arg-temp-transient"></a></dt>
<dd><p>Logical. If TRUE, temperature deltas ramp linearly from zero to twice `temp_delta`
across simulation years, preserving the same mean change.</p></dd>


<dt id="arg-precip-transient">precip_transient<a class="anchor" aria-label="anchor" href="#arg-precip-transient"></a></dt>
<dd><p>Logical. If TRUE, precipitation mean and variance factors ramp linearly across
simulation years using the same transient logic.</p></dd>


<dt id="arg-precip-occurrence-transient">precip_occurrence_transient<a class="anchor" aria-label="anchor" href="#arg-precip-occurrence-transient"></a></dt>
<dd><p>Logical. If TRUE, precipitation occurrence factors ramp linearly across
simulation years.</p></dd>


<dt id="arg-compute-pet">compute_pet<a class="anchor" aria-label="anchor" href="#arg-compute-pet"></a></dt>
<dd><p>Logical. If TRUE, recompute PET from perturbed temperature using
[calculate_monthly_pet()].</p></dd>


<dt id="arg-pet-method">pet_method<a class="anchor" aria-label="anchor" href="#arg-pet-method"></a></dt>
<dd><p>Character string specifying the PET method passed to [calculate_monthly_pet()] (default:
"hargreaves").</p></dd>


<dt id="arg-qm-fit-method">qm_fit_method<a class="anchor" aria-label="anchor" href="#arg-qm-fit-method"></a></dt>
<dd><p>Character string specifying the Gamma fitting method passed to
[adjust_precipitation_qm()] (e.g., "mme", "mle").</p></dd>


<dt id="arg-scale-var-with-mean">scale_var_with_mean<a class="anchor" aria-label="anchor" href="#arg-scale-var-with-mean"></a></dt>
<dd><p>Logical. If TRUE, precipitation variance scaling is computed as
`var_factor_use = precip_var_factor * precip_mean_factor^2`.</p></dd>


<dt id="arg-exaggerate-extremes">exaggerate_extremes<a class="anchor" aria-label="anchor" href="#arg-exaggerate-extremes"></a></dt>
<dd><p>Logical. If TRUE, amplify upper-tail wet-day precipitation during the intensity
quantile mapping step (forwarded to [adjust_precipitation_qm()]).</p></dd>


<dt id="arg-extreme-prob-threshold">extreme_prob_threshold<a class="anchor" aria-label="anchor" href="#arg-extreme-prob-threshold"></a></dt>
<dd><p>Numeric scalar in (0, 1). Probability threshold defining the start of the tail
region for amplification in [adjust_precipitation_qm()].</p></dd>


<dt id="arg-extreme-k">extreme_k<a class="anchor" aria-label="anchor" href="#arg-extreme-k"></a></dt>
<dd><p>Numeric scalar &gt; 0. Tail exponent controlling amplification strength in
[adjust_precipitation_qm()]. Values &gt; 1 amplify extremes; values in (0, 1) dampen.</p></dd>


<dt id="arg-enforce-target-mean">enforce_target_mean<a class="anchor" aria-label="anchor" href="#arg-enforce-target-mean"></a></dt>
<dd><p>Logical. If TRUE, rescale mapped wet-day values within each (year index, month)
group so the wet-day mean matches the intended target mean after tail amplification.</p></dd>


<dt id="arg-precip-cap-mm-day">precip_cap_mm_day<a class="anchor" aria-label="anchor" href="#arg-precip-cap-mm-day"></a></dt>
<dd><p>Optional numeric scalar. Absolute upper cap (mm/day) applied to precipitation after
all perturbations.</p></dd>


<dt id="arg-precip-floor-mm-day">precip_floor_mm_day<a class="anchor" aria-label="anchor" href="#arg-precip-floor-mm-day"></a></dt>
<dd><p>Optional numeric scalar. Minimum precipitation amount (mm/day) applied to wet days
after perturbation.</p></dd>


<dt id="arg-precip-cap-quantile">precip_cap_quantile<a class="anchor" aria-label="anchor" href="#arg-precip-cap-quantile"></a></dt>
<dd><p>Optional numeric scalar in (0, 1). Quantile-based cap computed from the perturbed
precipitation series and applied as an additional upper bound.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Optional integer. Sets the random seed for reproducible precipitation occurrence perturbations
and any stochastic components.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If TRUE, prints progress messages and warnings.</p></dd>


<dt id="arg-diagnostic">diagnostic<a class="anchor" aria-label="anchor" href="#arg-diagnostic"></a></dt>
<dd><p>Logical. If TRUE (default), return precipitation quantile-mapping diagnostics from
[adjust_precipitation_qm()] alongside the perturbed data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If `diagnostic = TRUE` (default), a list with:
* `data`: list of data.frames (one per grid cell)
* `diagnostic`: list of per-grid diagnostic objects returned by [adjust_precipitation_qm()], with the large
  `adjusted` vector removed</p>
<p>If `diagnostic = FALSE`, only the list of data.frames is returned.</p>
    </div>
    <div class="section level2">
    <h2 id="year-indexing-convention-critical-">Year indexing convention (critical)<a class="anchor" aria-label="anchor" href="#year-indexing-convention-critical-"></a></h2>


<p>All precipitation perturbations rely on a simulation-year index `year_idx = 1..n_years`,
derived internally from `date`. Calendar years are not passed downstream. Any factor
matrices supplied as `n_years x 12` are indexed using this simulation-year convention.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[adjust_precipitation_qm()], [calculate_monthly_pet()]</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by M.Umit Taner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

