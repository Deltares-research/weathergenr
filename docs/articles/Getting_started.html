<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="weathergenr">
<title>Getting started • weathergenr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="weathergenr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">weathergenr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Getting_started.html">Getting started</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started</h1>
            
      
      
      <div class="d-none name"><code>Getting_started.rmd</code></div>
    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 8px;
}
h1.title {
  margin-top:1em;
  margin-bottom:.50em;
  font-size: 30px;
  color: DarkBlue;
}
h1 { /* Header 1 */
  font-size: 24px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 20px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 20px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
}
code.r{ /* Code block */
    font-size: 14px;
}

code.python{ /* Code block */
    font-size: 14px;
}

pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette introduces you to the basics of the multivariable,
multigrid stochastic daily weather series generation process with
<em>weathergenr</em>. The package consists of a series of R scripts and
function wrappers built upon the work by Steinscheineder et al (2013).
This implementation works directly with gridded hydrometeorological
datasets (e.g., ERA5) through netcdf files and provide further
automatization of the underlying statistical processes. Recoded
functions also provide significant speed improvements in most cases.</p>
<p>In this tutorial, you’ll first learn how to easily generate new
stochastic weather realizations for a specific geographic area. Next,
you’ll learn how to impose climate changes on the generated stochastic
weather realizations, for example, as changes in monthly means and
variance of temperature and precipitation. Finally, you will see a
simple illustration of how the input data for a “climate stress test”
can generated.</p>
</div>
<div class="section level2">
<h2 id="installation-and-setup">Installation and setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h2>
<p>The latest version of the weathergenr package can be installed from
github and then loaded to the environment:</p>
<pre><code>#&gt;   
  
  
   checking for file 'C:\Users\taner\AppData\Local\Temp\Rtmpqeptpf\remotesb313c49355c9d\Deltares-weathergenr-f518728/DESCRIPTION' ...
  
   checking for file 'C:\Users\taner\AppData\Local\Temp\Rtmpqeptpf\remotesb313c49355c9d\Deltares-weathergenr-f518728/DESCRIPTION' ... 
  
 [32mv [39m   [38;5;247mchecking for file 'C:\Users\taner\AppData\Local\Temp\Rtmpqeptpf\remotesb313c49355c9d\Deltares-weathergenr-f518728/DESCRIPTION' [39m [36m [36m (564ms) [36m [39m
#&gt; 
  
  
  
 [38;5;247m- [39m [38;5;247m   [39m [38;5;247mpreparing 'weathergenr': [39m [36m [39m
#&gt;    checking DESCRIPTION meta-information ...
  
   checking DESCRIPTION meta-information ... 
  
 [32mv [39m   [38;5;247mchecking DESCRIPTION meta-information [39m [36m [39m
#&gt; 
  
  
  
 [38;5;247m- [39m [38;5;247m   [39m [38;5;247mchecking for LF line-endings in source and make files and shell scripts [39m [36m [39m
#&gt; 
  
  
  
 [38;5;247m- [39m [38;5;247m   [39m [38;5;247mchecking for empty or unneeded directories [39m [36m [39m
#&gt; 
  
   Omitted 'LazyData' from DESCRIPTION
#&gt; 
  
  
  
 [38;5;247m- [39m [38;5;247m   [39m [38;5;247mbuilding 'weathergenr_0.0.2.tar.gz' [39m [36m [39m
#&gt; 
  
   
#&gt; </code></pre>
</div>
<div class="section level2">
<h2 id="simple-examples">Simple examples<a class="anchor" aria-label="anchor" href="#simple-examples"></a>
</h2>
<div class="section level3">
<h3 id="reading-in-weather-data-from-netcdf">Reading in weather data from netcdf<a class="anchor" aria-label="anchor" href="#reading-in-weather-data-from-netcdf"></a>
</h3>
<p>The weather generator takes gridded weather data for a previously
cropped geographic area, provided as a netcdf file. Thus, the first step
is to read-in weather data and associated spatial information from an
external file.</p>
<p>For this exercise, we will use the sample netcdf file that comes with
the package. The file provides long-term gridded metereological data for
the Ntoum basin, Gabon. The <em>readNetcdf()</em> is a wrapper for
several ncdf4 functions to extract metereological data from netcdf files
with associated spatial coordinates, dates, dimensions (time, x, y) and
variable attributes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ncfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ntoum_era5_data.nc"</span>, package <span class="op">=</span> <span class="st">"weathergenr"</span><span class="op">)</span>
<span class="va">ncdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readNetcdf.html">readNetcdf</a></span><span class="op">(</span><span class="va">ncfile</span><span class="op">)</span></code></pre></div>
<p>The output object stores various information from the netcdf
file:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ncdata</span><span class="op">)</span>
<span class="co">#&gt; [1] "data"       "grid"       "date"       "dimensions" "attributes"</span></code></pre></div>
<p>Metereological data is stored as a list object via <em>data</em>
element. Each list represents a different grid cell in “tidy” format,
i.e., with observations on rows and metereological variables on
columns:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display climate data for the first gridcell</span>
<span class="va">ncdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,671 x 7</span></span>
<span class="co">#&gt;    press_msl   kin temp_min temp_max  temp  kout precip</span>
<span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     <span style="text-decoration: underline;">1</span>008.  174.     24.4     28.1  25.9  410.  9.12 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     <span style="text-decoration: underline;">1</span>008.  162.     23.7     28.1  24.9  410. 15.6  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     <span style="text-decoration: underline;">1</span>008.  201.     23.6     27.9  25.6  411.  4.84 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     <span style="text-decoration: underline;">1</span>008.  177.     25.0     28.3  26.1  411.  5.20 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     <span style="text-decoration: underline;">1</span>007.  218.     24.6     28.1  26.1  411.  1.54 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     <span style="text-decoration: underline;">1</span>007.  199.     25.0     28.2  26.3  411.  8.35 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     <span style="text-decoration: underline;">1</span>008.  195.     24.3     28.3  25.9  412. 14.4  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     <span style="text-decoration: underline;">1</span>009.  158.     24.6     26.5  25.4  412. 11.4  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     <span style="text-decoration: underline;">1</span>010.  143.     24.1     27.1  25.1  413.  9.15 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     <span style="text-decoration: underline;">1</span>009.  220.     23.9     28.6  26.1  413.  0.810</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 7,661 more rows</span></span></code></pre></div>
<p>Information on the grids can be accessed via the <em>grid</em>
element. It is also provided as a data frame with columns grid index
followed by x and y dimension indices and x and y coordinate values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display grid information</span>
<span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 x 5</span></span>
<span class="co">#&gt;      id  xind  yind     x     y</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     1     1  9.5   0.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2     2     1  9.75  0.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3     3     1 10     0.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4     1     2  9.5   0.25</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5     2     2  9.75  0.25</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6     3     2 10     0.25</span></code></pre></div>
<p>Finally, the date series associated with the data can be accessed
with the <em>date</em> element:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display start and ending values date vector</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ncdata</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>
<span class="co">#&gt; [1] "2000-01-01" "2000-01-02" "2000-01-03" "2000-01-04" "2000-01-05"</span>
<span class="co">#&gt; [6] "2000-01-06"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">ncdata</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-12-26" "2020-12-27" "2020-12-28" "2020-12-29" "2020-12-30"</span>
<span class="co">#&gt; [6] "2020-12-31"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-stochastic-weather-realizations">Generate stochastic weather realizations<a class="anchor" aria-label="anchor" href="#generate-stochastic-weather-realizations"></a>
</h3>
<p>In this section, we introduce the procedure to obtain new weather
sequences from the historical weather record via the
<em>generateWeatherSeries()</em> function. This function serves as a
wrapper arround a number of statistical procedures including a wavelet
autoregressive model (WARM) coupled with a Markov chain knn resampling
scheme based on Steinschneider and Brown (2013).</p>
<p>First, lets specify an output path for the results and variables to
include from the dataset:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set path to store weather generator results</span>
<span class="va">output_path</span> <span class="op">&lt;-</span> <span class="st">"C:/testrun/"</span>
<span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"precip"</span>, <span class="st">"temp"</span>, <span class="st">"temp_min"</span>, <span class="st">"temp_max"</span><span class="op">)</span>
<span class="va">realization_num</span> <span class="op">&lt;-</span> <span class="fl">3</span></code></pre></div>
<p>GenerateWeatherSeries() function includes a large set of essential
and non-essential parameters to control the weather generation process.
Essential parameters include: <em>weather.data</em>,
<em>weather.grid</em>, and <em>weather.date</em> and
<em>variable.names</em> to specify the attributes of the input
metereological data, <em>realization.num</em> to set the desired number
of new weather realizations, and the <em>output.path</em>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stochastic_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateWeatherSeries.html">generateWeatherSeries</a></span><span class="op">(</span>
     weather.data <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">data</span>,
     weather.grid <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>,
     weather.date <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">date</span>,
     variable.names <span class="op">=</span> <span class="va">variables</span>,
     variable.labels <span class="op">=</span> <span class="va">variables</span>,
     variable.units <span class="op">=</span> <span class="cn">NULL</span>,
     sim.year.num <span class="op">=</span> <span class="fl">20</span>,
     sim.year.start <span class="op">=</span> <span class="fl">2020</span>,
     month.start <span class="op">=</span> <span class="fl">1</span>,
     realization.num <span class="op">=</span> <span class="va">realization_num</span>,
     warm.variable <span class="op">=</span> <span class="st">"precip"</span>,
     warm.signif.level <span class="op">=</span> <span class="fl">0.90</span>,
     warm.sample.num <span class="op">=</span> <span class="fl">10000</span>,
     warm.subset.criteria <span class="op">=</span> <span class="cn">NULL</span>,
     knn.sample.num <span class="op">=</span> <span class="fl">120</span>,
     mc.wet.quantile<span class="op">=</span> <span class="fl">0.2</span>,
     mc.extreme.quantile <span class="op">=</span> <span class="fl">0.8</span>,
     evaluate.model <span class="op">=</span> <span class="cn">FALSE</span>,
     evaluate.grid.num <span class="op">=</span> <span class="fl">20</span>,
     output.path <span class="op">=</span> <span class="va">output_path</span>,
     seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></code></pre></div>
<p>The output is a list, where the first element is a data frame of
resampled dates for each new stochastic realization and a date vector
for the new (generated) weather data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Resampled dates</span>
<span class="va">stochastic_weather</span><span class="op">$</span><span class="va">resampled</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,300 x 3</span></span>
<span class="co">#&gt;    rlz_1      rlz_2      rlz_3     </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2001-01-01 2001-01-01 2001-01-01</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2000-01-01 2006-01-02 2006-01-01</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2012-01-02 2006-01-01 2006-01-02</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2012-01-05 2014-01-06 2006-01-01</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2000-01-06 2014-01-06 2006-01-02</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2002-01-07 2018-01-04 2016-01-09</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2019-01-06 2008-01-04 2001-01-10</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2002-01-06 2016-01-09 2016-01-09</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-06 2013-01-08 2013-01-11</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2002-01-13 2016-01-10 2001-01-07</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 7,290 more rows</span></span>

<span class="co"># Date vector</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stochastic_weather</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span>
<span class="co">#&gt; [1] "2021-01-01" "2021-01-02" "2021-01-03" "2021-01-04" "2021-01-05"</span>
<span class="co">#&gt; [6] "2021-01-06"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">stochastic_weather</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span>
<span class="co">#&gt; [1] "2040-12-26" "2040-12-27" "2040-12-28" "2040-12-29" "2040-12-30"</span>
<span class="co">#&gt; [6] "2040-12-31"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-climate-change-realizations">Apply climate change realizations<a class="anchor" aria-label="anchor" href="#apply-climate-change-realizations"></a>
</h3>
<p>Delta factors can be imposed on the historical or stochastically
generated weather data to reflect plausible changes on climate
statistics. Currently, it is possible to shift mean and variance of
precipitation and mean of temperature. Preciptation changes are
specified as ratios, where a value of 1.0 indicates no change for the
given calendar month. Temperature changes are specified as increases (or
decreases) in degree celsius in a given month.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Temperature changes Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec</span>
<span class="va">delta_temp_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.0</span>, <span class="fl">3.2</span>, <span class="fl">3.4</span>, <span class="fl">4.0</span>, <span class="fl">4.1</span>, <span class="fl">4.4</span>, <span class="fl">5.0</span>, <span class="fl">3.5</span>, <span class="fl">3.3</span>, <span class="fl">2.9</span>, <span class="fl">2.8</span>, <span class="fl">2.7</span><span class="op">)</span>

<span class="co"># Precipitation changes   Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec</span>
<span class="va">delta_precip_mean</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span><span class="op">)</span>
<span class="va">delta_precip_variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span>

<span class="co"># Select first realization</span>
<span class="va">day_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">stochastic_weather</span><span class="op">$</span><span class="va">resampled</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ncdata</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>

<span class="co"># Obtain stochastic series by re-ordering historical data</span>
<span class="va">stochastic_rlz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ncdata</span><span class="op">$</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">day_order</span>,<span class="op">]</span><span class="op">)</span>

<span class="co"># Apply climate changes to climate data</span>
<span class="va">stochastic2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imposeClimateChanges.html">imposeClimateChanges</a></span><span class="op">(</span>
   climate.data <span class="op">=</span> <span class="va">stochastic_rlz</span>,
   climate.grid <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>,
   sim.dates <span class="op">=</span> <span class="va">stochastic_weather</span><span class="op">$</span><span class="va">dates</span>,
   change.factor.precip.mean <span class="op">=</span> <span class="va">delta_precip_mean</span>,
   change.factor.precip.variance <span class="op">=</span> <span class="va">delta_precip_variance</span>,
   change.factor.temp.mean <span class="op">=</span> <span class="va">delta_temp_mean</span>,
   change.type.temp <span class="op">=</span> <span class="st">"transient"</span>,
   change.type.precip <span class="op">=</span> <span class="st">"transient"</span><span class="op">)</span></code></pre></div>
<p>Finally we can save the generated weather series back to a netcdf
file:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Save to netcdf file</span>
<span class="fu"><a href="../reference/writeNetcdf.html">writeNetcdf</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">stochastic2</span>,
    coord.grid <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>,
    output.path <span class="op">=</span> <span class="va">output_path</span>,
    origin.date <span class="op">=</span>  <span class="va">stochastic_weather</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
    calendar.type <span class="op">=</span> <span class="st">"noleap"</span>,
    nc.template.file <span class="op">=</span> <span class="va">ncfile</span>,
    nc.compression <span class="op">=</span> <span class="fl">4</span>,
    nc.spatial.ref <span class="op">=</span> <span class="st">"spatial_ref"</span>,
    nc.file.prefix <span class="op">=</span> <span class="st">"clim"</span>,
    nc.file.suffix <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="climate-stress-testing">Climate Stress Testing<a class="anchor" aria-label="anchor" href="#climate-stress-testing"></a>
</h2>
<p>Metereological input to a climate stress test can be generated by
obtaining a wide range of plausible weather conditions.<br></p>
<p>In this tutorial, we will generate 6 climate change scenarios by
combining 3 monthly precipitation changes and 2 monthly temperature
changes. We will then apply these scenarios to 3 natural variability
realizations, resulting in a total of 6 x 3 = 18 scenarios.<br></p>
<div class="section level3">
<h3 id="defining-the-stress-testing-matrix">Defining the stress testing matrix<a class="anchor" aria-label="anchor" href="#defining-the-stress-testing-matrix"></a>
</h3>
<p>The first step is define a data table to store all information
regarding the scenarios, e.g., how weather statistics are being changed.
To do this, we first define a bandwith range (e.g., minimum and maximum
values) to define the delta factors for each climate statistic being
perturbed. In the example below, we vary three statistics: mean of
precipitation, variance of precipitation, and mean of temperature.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Temp mean changes Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec</span>
<span class="va">delta_temp_mean_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>
<span class="va">delta_temp_mean_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span><span class="op">)</span>

<span class="co"># Precip mean changes   Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec</span>
<span class="va">delta_precip_mean_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span><span class="op">)</span>
<span class="va">delta_precip_mean_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span><span class="op">)</span>

<span class="co"># Precip variance changes   Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec</span>
<span class="va">delta_precip_variance_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span>
<span class="va">delta_precip_variance_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span>

<span class="co"># Number of incremental step changes for precip and temp variables</span>
<span class="va">precip_step_num</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">temp_step_num</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">precip_mean_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
         <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">delta_precip_mean_min</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>, <span class="va">delta_precip_mean_max</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>,
             length.out <span class="op">=</span> <span class="va">precip_step_num</span><span class="op">)</span><span class="op">)</span>

<span class="va">precip_variance_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
         <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">delta_precip_variance_min</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>, <span class="va">delta_precip_variance_max</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>,
             length.out <span class="op">=</span> <span class="va">precip_step_num</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_mean_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
         <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">delta_temp_mean_min</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>, <span class="va">delta_temp_mean_max</span><span class="op">[</span><span class="va">m</span><span class="op">]</span>,
             length.out <span class="op">=</span> <span class="va">temp_step_num</span><span class="op">)</span><span class="op">)</span>

 <span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">precip_mean_steps</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>level <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
   variable <span class="op">=</span> <span class="st">"precip_mean"</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
 <span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">precip_variance_steps</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>level <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
   variable <span class="op">=</span> <span class="st">"precip_variance"</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
 <span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">temp_mean_steps</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>level <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
   variable <span class="op">=</span> <span class="st">"temp_mean"</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
 <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, <span class="va">df3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">gather</span><span class="op">(</span><span class="va">month</span>, <span class="va">value</span>, <span class="va">V1</span><span class="op">:</span><span class="va">V12</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu">mutate</span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">month</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span>

 <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">level</span>, color <span class="op">=</span> <span class="va">level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"month"</span>, y <span class="op">=</span> <span class="st">"delta factor"</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">scale_color_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

 <span class="va">p</span></code></pre></div>
<p>Now lets create the scenario matrix using the bandwiths and
incremental step sizes specified for each variable</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Stress test matrix</span>
 <span class="va">strtest_matrix</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>stoc_ind <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">realization_num</span>,
   precip_ind <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">precip_step_num</span>, temp_ind <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">temp_step_num</span><span class="op">)</span>

 <span class="co"># Total number of scenarios</span>
 <span class="va">smax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">strtest_matrix</span><span class="op">)</span>

 <span class="co"># Stress test delta factors for each variable/climate statistic</span>
 <span class="va">strtest_matrix_precip_mean</span> <span class="op">&lt;-</span> <span class="va">precip_mean_steps</span><span class="op">[</span><span class="va">strtest_matrix</span><span class="op">$</span><span class="va">precip_ind</span>, <span class="op">]</span>
 <span class="va">strtest_matrix_precip_variance</span> <span class="op">&lt;-</span> <span class="va">precip_variance_steps</span><span class="op">[</span><span class="va">strtest_matrix</span><span class="op">$</span><span class="va">precip_ind</span>, <span class="op">]</span>
 <span class="va">strtest_matrix_temp_mean</span> <span class="op">&lt;-</span> <span class="va">temp_mean_steps</span><span class="op">[</span><span class="va">strtest_matrix</span><span class="op">$</span><span class="va">temp_ind</span>, <span class="op">]</span></code></pre></div>
<p># Write stress test matrices to file (optional)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">strtest_matrix</span>,
   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"strtest_matrix.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">strtest_matrix_precip_mean</span>,
   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"strtest_matrix_precip_mean.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">strtest_matrix_precip_variance</span>,
   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"strtest_matrix_precip_variance.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">strtest_matrix_temp_mean</span>,
   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"strtest_matrix_temp_mean.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Finally, lets generate the stress test input data</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co"># Read-in resampled dates &amp; date series (from csv files included with the package)</span>
 <span class="va">resampled_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"resampled_dates.csv"</span>, package <span class="op">=</span> <span class="st">"weathergenr"</span><span class="op">)</span>,
   colClasses <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span>
 <span class="va">sim_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sim_dates.csv"</span>, package <span class="op">=</span> <span class="st">"weathergenr"</span><span class="op">)</span>,
   colClasses <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

 <span class="co"># Use results from generateWeatherSeries function output</span>
 <span class="co"># resampled_dates &lt;- stochastic_weather$resampled</span>
 <span class="co"># sim_dates &lt;- stochastic_weather$dates</span>

<span class="co"># progress bar (optional)</span>
<span class="va">pb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html" class="external-link">txtProgressBar</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="va">smax</span>, initial <span class="op">=</span> <span class="fl">0</span>, style <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
 <span class="kw">for</span> <span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">smax</span><span class="op">)</span> <span class="op">{</span>

   <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html" class="external-link">setTxtProgressBar</a></span><span class="op">(</span><span class="va">pb</span>,<span class="va">s</span><span class="op">)</span>

   <span class="co"># Find the current scenario indices for the stochastic realization and delta factors</span>
   <span class="va">stoc_ind</span> <span class="op">&lt;-</span> <span class="va">strtest_matrix</span><span class="op">$</span><span class="va">stoc_ind</span><span class="op">[</span><span class="va">s</span><span class="op">]</span>

   <span class="co"># Obtain stochastic series by re-ordering historical data</span>
   <span class="va">day_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">resampled_dates</span><span class="op">[[</span><span class="va">stoc_ind</span><span class="op">]</span><span class="op">]</span>, <span class="va">ncdata</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>
   <span class="va">rlz_historical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ncdata</span><span class="op">$</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">day_order</span>,<span class="op">]</span><span class="op">)</span>

   <span class="co"># Apply climate changes to climate data</span>
   <span class="va">rlz_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imposeClimateChanges.html">imposeClimateChanges</a></span><span class="op">(</span>
     climate.data <span class="op">=</span> <span class="va">rlz_historical</span>,
     climate.grid <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>,
     sim.dates <span class="op">=</span> <span class="va">sim_dates</span>,
     change.factor.precip.mean <span class="op">=</span> <span class="va">strtest_matrix_precip_mean</span><span class="op">[</span><span class="va">s</span>,<span class="op">]</span>,
     change.factor.precip.variance <span class="op">=</span> <span class="va">strtest_matrix_precip_variance</span><span class="op">[</span><span class="va">s</span>,<span class="op">]</span>,
     change.factor.temp.mean <span class="op">=</span> <span class="va">strtest_matrix_temp_mean</span><span class="op">[</span><span class="va">s</span>,<span class="op">]</span>,
     change.type.temp <span class="op">=</span> <span class="st">"transient"</span>,
     change.type.precip <span class="op">=</span> <span class="st">"transient"</span><span class="op">)</span>

     <span class="co"># Save to netcdf file</span>
     <span class="fu"><a href="../reference/writeNetcdf.html">writeNetcdf</a></span><span class="op">(</span>
       data <span class="op">=</span> <span class="va">rlz_future</span>,
       coord.grid <span class="op">=</span> <span class="va">ncdata</span><span class="op">$</span><span class="va">grid</span>,
       output.path <span class="op">=</span> <span class="va">output_path</span>,
       origin.date <span class="op">=</span>  <span class="va">stochastic_weather</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
       calendar.type <span class="op">=</span> <span class="st">"noleap"</span>,
       nc.template.file <span class="op">=</span> <span class="va">ncfile</span>,
       nc.compression <span class="op">=</span> <span class="fl">4</span>,
       nc.spatial.ref <span class="op">=</span> <span class="st">"spatial_ref"</span>,
       nc.file.prefix <span class="op">=</span> <span class="st">"climx"</span>,
       nc.file.suffix <span class="op">=</span> <span class="va">s</span><span class="op">)</span>
 <span class="op">}</span>
 <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">pb</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="running-weather-generator-from-python">Running weather generator from python<a class="anchor" aria-label="anchor" href="#running-weather-generator-from-python"></a>
</h2>
<p><em>in progress</em></p>
<p>Prerequisites:<br>
1. Install latest version of R via <a href="https://mirror.lyrahosting.com/CRAN/" class="external-link uri">https://mirror.lyrahosting.com/CRAN/</a><br>
2. Create a new python environment with packages rpy2, r-base,
r-essentials, pandas, numpy2<br></p>
<p>First set the PATH variables correctly</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'PATH'</span>] <span class="op">=</span> <span class="st">'C:/Program Files/R/R-4.1.2/bin/x64'</span> <span class="op">+</span> os.pathsep <span class="op">+</span> os.environ.get(<span class="st">'PATH'</span>, <span class="st">''</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'PYTHONHOME'</span>] <span class="op">=</span> <span class="st">'C:/Users/taner/Anaconda3/envs/wegentest'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'PYTHONPATH'</span>] <span class="op">=</span> <span class="st">'C:/Users/taner/Anaconda3/envs/wegentest/Lib/site-packages'</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Location of R executable</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'R_HOME'</span>] <span class="op">=</span> <span class="st">'C:/Program Files/R/R-4.1.2'</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Location of R packages installed</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'R_USER'</span>] <span class="op">=</span> <span class="st">'C:/Users/taner/Anaconda3/envs/wegentest/Lib/site-packages/rpy2'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if variables are correctly defined for rpy2</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2.situation</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rpy2.situation.iter_info():</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Import necessary packages</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2.robjects <span class="im">as</span> robjects</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.packages <span class="im">import</span> importr</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># This is needed for conversion between R and Python syntax</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">'package.dependencies'</span>: <span class="st">'package_dot_dependencies'</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>     <span class="st">'package_dependencies'</span>: <span class="st">'package_uscore_dependencies'</span>}</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Load core packages</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> importr(<span class="st">'base'</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>utils <span class="op">=</span> importr(<span class="st">'utils'</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>utils.chooseCRANmirror(ind<span class="op">=</span><span class="dv">1</span>) <span class="co"># select the first mirror in the list</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>devtools <span class="op">=</span> utils.install_packages(<span class="st">'devtools'</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>devtools <span class="op">=</span> importr(<span class="st">'devtools'</span>, robject_translations <span class="op">=</span> d)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Install weathergenr from Github master branch</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>weathergenr <span class="op">=</span> devtools.install_github(<span class="st">"tanerumit/weathergenr"</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>weathergenr <span class="op">=</span> importr(<span class="st">'weathergenr'</span>, robject_translations <span class="op">=</span> d)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load netcdf file</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ncfile <span class="op">=</span> base.system_file(<span class="st">"extdata"</span>, <span class="st">"ntoum_era5_data.nc"</span>, package <span class="op">=</span> <span class="st">"weathergenr"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ncdata <span class="op">=</span> weathergenr.readNetcdf(ncfile)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set path to store weather generator results</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"C:/testrun/"</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> base.c(<span class="st">"precip"</span>, <span class="st">"temp"</span>, <span class="st">"temp_min"</span>, <span class="st">"temp_max"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>realization_num <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>stochastic_weather <span class="op">=</span> weathergenr.generateWeatherSeries(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>     weather_data <span class="op">=</span> ncdata[<span class="dv">0</span>],</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>     weather_grid <span class="op">=</span> ncdata[<span class="dv">1</span>],</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>     weather_date <span class="op">=</span> ncdata[<span class="dv">2</span>],</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>     variable_names <span class="op">=</span> variables,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>     output_path <span class="op">=</span> output_path,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>     month_start <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>     realization_num <span class="op">=</span> realization_num,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>     warm_variable <span class="op">=</span> <span class="st">"precip"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>     warm_signif_level <span class="op">=</span> <span class="fl">0.90</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>     warm_sample_num <span class="op">=</span> <span class="dv">5000</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>     knn_sample_num <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>     evaluate_model <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>     evaluate_grid_num <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>     mc_wet_threshold <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>     mc_extreme_quantile <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>     seed <span class="op">=</span> <span class="dv">100</span>)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mehmet Umit Taner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
